
@inherits Panel

<root>
    <label @ref="ActionName" class="name"></label>
    <div @ref="Icon" class="icon">
        <div class="charge"></div>
    </div>
</root>

@code {
    public Label ActionName { get; set; }
    public Panel Icon { get; set; }

    private InputButton button;
    private Texture customTexture;

    public void Set(string name, InputButton button, bool hasCharge = false)
    {
        SetClass("open", true);
        SetClass("has-charge", hasCharge);
        Sound.FromScreen("sounds/misc/tutorial.hint.sound");

        ActionName.Text = name;
        customTexture = null;
        this.button = button;
    }

    public void Set(string name, InputActions action, bool hasCharge = false)
    {
        SetClass("open", true);
        SetClass("has-charge", hasCharge);
        Sound.FromScreen("sounds/misc/tutorial.hint.sound");

        ActionName.Text = name;
        customTexture = GetCustomTexture(action);
        button = InputButton.Chat;
    }

    public override void Tick()
    {
        base.Tick();

        var tex = customTexture ?? Input.GetGlyph(button, InputGlyphSize.Large, GlyphStyle.Knockout);
        Icon.Style.BackgroundImage = tex;
    }

    private Texture GetCustomTexture(InputActions action)
    {
        var path = action switch
        {
            InputActions.Lean => "textures/ui/control_lean",
            InputActions.Look => "textures/ui/control_look",
            _ => ""
        };

        if (Input.UsingController)
            path += "_controller";

        path += ".png";

        return Texture.Load(FileSystem.Mounted, path);
    }
}
